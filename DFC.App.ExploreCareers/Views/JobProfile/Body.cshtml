@model DFC.App.ExploreCareers.ViewModels.JobProfile.BodyViewModel

<div class='govuk-width-container'>

    <div id="results">
        <div class="results-block">
            <div class="inner-block">
                <p id="result-count" class="result-count">
                    Showing 1 to @Model.JobProfile.Count of @Model.TotalResults job profiles
                </p>

                <div class="govuk-grid-row">
                    <hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">
                </div>

                @if (Model.JobProfile != null && Model.JobProfile.Any())
                {
                    <ol class="results-list">
                        @foreach (var job in Model.JobProfile)
                        {
                             <li class="dfc-code-search-resultitem">
                                <h3><a class="dfc-code-search-jpTitle" href="/job-profiles@{@job.PageLocation.FullUrl}" style="text-decoration: underline;">@job.DisplayText</a></h3>

                                @if (!string.IsNullOrWhiteSpace(@job.DisplayText))
                                {
                                    <p class="meta dfc-code-search-jpAltTitle"><span class="sr-hidden">Alternative titles for this job include </span>@job.AlternativeTitle</p>
                                }

                                <p class="result-description dfc-code-search-jpOverview">@job.Overview</p>

                                <p class="results-salary">
                                    Salary:   <span class="dfc-code-search-jpSalary">
                                        @((job.SalaryStarterPerYear == 0 && job.SalaryExperiencedPerYear == 0)
                                            ? "Variable"
                                            : ("£" + job.SalaryStarterPerYear.ToString("N0") + " to £" + job.SalaryExperiencedPerYear.ToString("N0")))
                                    </span>
                                </p>

                                @if (job.JobProfileSector != null && job.JobProfileSector.ContentItems.Any())
                                {
                                    <p class="results-categories">
                                        Found in:
                                        @Html.Raw(string.Join(" ", job.JobProfileSector.ContentItems.Select(sector => $"<a href='explore-careers/job-sector/{sector.FullUrl}'>{sector.DisplayText}</a>")))
                                    </p>
                                } 
                                else
                                {
                                    <p class="results-categories">
                                        Found in:
                                            <p>No job profile sectors available.</p>
                                    </p>
                                }
                            </li>
                        }
                    </ol>
                }
                else
                {
                    <p>No job profile is available.</p>
                }
            </div>


            <div class="govuk-grid-row">
                <hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">
            </div>


            <!-- Pagination -->
            <nav class="hods-pagination__navigation govuk-!-margin-top-6" role="navigation" aria-label="Pagination Navigation">
                <div class="hods-pagination__navigation__summary">
                    Showing 1 to @Model.JobProfile?.Count of @Model.TotalResults job profiles
                </div>

                <ul class="hods-pagination__navigation__list-items">
                    @{
                        int totalPages = (int)Math.Ceiling((double)@Model.TotalResults / @Model.PageSize);
                        int startPage = Math.Max(1, @Model.PageNumber - 2);
                        int endPage = Math.Min(startPage + 4, totalPages);

                        // Previous Page
                        if (Model.PageNumber > 1)
                        {
                            <li class="hods-pagination__navigation__item">
                                <a class="govuk-link hods-pagination__navigation__link" aria-label="Previous page" href="?page=@(Model.PageNumber - 1)" rel="prev">
                                    <span aria-hidden="true" role="presentation">«</span> Previous
                                </a>
                            </li>
                        }

                        // Page Numbers
                        for (int i = startPage; i <= endPage; i++)
                        {
                            <li class="hods-pagination__navigation__item @(Model.PageNumber == i ? "hods-pagination__navigation__item--current" : "")">
                                <a class="hods-pagination__navigation__link @(Model.PageNumber == i ? "hods-pagination__navigation__link--current" : "")" href="?page=@i" aria-label="Page @i" @(Model.PageNumber == i ? "aria-current=\"page\"" : "")>
                                    @i
                                </a>
                            </li>
                        }

                        // Next Page
                        if (Model.PageNumber < totalPages)
                        {
                            <li class="hods-pagination__navigation__item">
                                <a class="govuk-link hods-pagination__navigation__link" aria-label="Next page" href="?page=@(Model.PageNumber + 1)" rel="next">
                                    Next <span aria-hidden="true" role="presentation">»</span>
                                </a>
                            </li>
                        }
                    }
                </ul>
            </nav>

        </div>
    </div>

    @if (Model?.SharedContents != null && Model.SharedContents.Count > 0 && Model.SharedContents[0]?.Content?.Html != null)
    {
        <div class="govuk-grid-row">
            @Html.Raw(Model.SharedContents[0].Content.Html)
        </div>
    }
    else
    {
        <div class="govuk-grid-row">
            <p>No content available</p>
        </div>
    }
</div>
